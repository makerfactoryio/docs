# Environmental sensor

## Description
BME680 is an integrated environmental sensor providing pressure, relative humidity, temperature and Volatile Organic Compounds resistance measurements. Based on those readings Bosch Sensortec Environmental Cluster library can estimate indoor air quality. Communication with the sensor is carried over I2C interface.

### Part details

Manufacturer:
Bosch Sensortec GmbH

Part number:
BME680

Datasheet: [link](https://ae-bst.resource.bosch.com/media/_tech/media/datasheets/BST-BME680-DS001-00.pdf)

## Code example

!!! info "Compiling example"
    This example is based on Mbed OS and requires a simple setup. For full description check [Code Setup](./code-setup.md) page.

### BME680 driver

#### Raw measurements
Raw measurements can be collected by using following drivers:

- [official Bosch Sensortec driver on Github](https://github.com/BoschSensortec/BME680_driver)
- [Mbed OS wrapper for official driver](https://github.com/slashdevteam/BME680)

!!! warning "Compilation errors with official Bosch Sensortec driver"
    Official BME680 driver contains a "Self test" folder, which can cause wrong project generation by `mbed-cli`. To avoid issues please add `BME680_driver/Self test/*` line to `.mbedignore` file in root folder of project.

#### Indoor air quality estimation
Proprietary Bosch Sensortec Environmental Cluster library is required to calculate indoor air quality index based on BME680 measurements. This library requires:

- both drivers from [Raw measurements](#raw-measurements)
- BSEC library from [here](https://www.bosch-sensortec.com/bst/products/all_products/bsec) (example tested with v1.4.7.1 from Sept. 18th, 2018)
- [BSEC Mbed OS wrapper from Github](https://github.com/).

Following files from BSEC distribution should be copied to project folder:

- from BSEC `config` folder (we recommend starting with `generic_33v_3s_4d` configuration):
    - `bsec_serialized_configurations_iaq.c`
    - `bsec_serialized_configurations_iaq.h`
- from BSEC `algo/bin/Normal_version/gcc/Cortex_M4` folder:
    - `bsec_interface.h`
    - `bsec_datatypes.h`
    - `libalgobsec.a`

Additionally, compilation profiles (`release.json` or `debug.json`) should be updated to include additional linker statement - `"-l algobsec"` - in `GCC_ARM.ld` section.


### Code

#### Raw measurements
This example show basic BME680 usage to get raw pressure, relative humidity, temperature and Volatile Organic Compounds resistance measurements.

```c++
{!development-boards/sensorio/assets/bme680main.cpp!}
```

Example `main.cpp` file can be downloaded from [here](./assets/bme680main.cpp).

#### Indoor air quality
This example uses BSEC library to get all raw measurement as well as Indoor Air Quality Index.

!!! info "IAQ values"
    Please note that IAQ calculations depend on sensor calibration which can take several minutes. IAQ value is meaningful only when state is `LOW_ACCURACY` or higher.

```c++
{!development-boards/sensorio/assets/iaqmain.cpp!}
```

Example `main.cpp` file can be downloaded from [here](./assets/iaqmain.cpp).
